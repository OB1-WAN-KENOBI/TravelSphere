import{j as e,F as f,I as b,S as v,M as m,d as M,e as P,f as F,g as R,D as L,h as E}from"./mui-vendor-CLtSI9R1.js";import{u as T,I as h,B as k,L as B}from"./index-p_fKfQYs.js";import{u as _}from"./filtersStore-CTVUUJjt.js";import{r as y}from"./react-vendor-Dk88p5LA.js";import{T as I}from"./TourCard-gEPcKEBq.js";import{u as O}from"./TourCard-3c7UuxNQ.js";import{E as q}from"./EmptyState-8rDh236D.js";import{E as A}from"./fetchJson-BLxyqeaT.js";import"./query-vendor-DUWNuxmm.js";import"./mapbox-vendor-CJddBv8R.js";import"./Card-Lk3I794p.js";import"./formatPrice-BWDoC67r.js";const D={BEACH:"пляжный",EXCURSION:"экскурсионный",ACTIVE:"активный"},W=()=>{const t=_();return{country:t.country,dateFrom:t.dateFrom,dateTo:t.dateTo,budgetMin:t.budgetMin,budgetMax:t.budgetMax,visaRequired:t.visaRequired,tourType:t.tourType,stars:t.stars,setCountry:t.setCountry,setDateRange:t.setDateRange,setBudget:t.setBudget,setVisaRequired:t.setVisaRequired,setTourType:t.setTourType,setStars:t.setStars,resetFilters:t.resetFilters}},C=()=>{const{country:t,dateFrom:r,dateTo:a,budgetMin:i,budgetMax:u,visaRequired:c,tourType:d,stars:p,setCountry:g,setDateRange:o,setBudget:x,setVisaRequired:n,setTourType:j,setStars:N,resetFilters:S}=W(),{t:l}=T();return e.jsxs("div",{className:"tour-filters",children:[e.jsx("h3",{className:"tour-filters__title",children:l.tourFilters.title}),e.jsx(h,{label:l.tourFilters.country,value:t||"",onChange:s=>g(s.target.value||null),fullWidth:!0}),e.jsx(h,{label:l.tourFilters.dateFrom,type:"date",value:r||"",onChange:s=>o(s.target.value||null,a),fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsx(h,{label:l.tourFilters.dateTo,type:"date",value:a||"",onChange:s=>o(r,s.target.value||null),fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsx(h,{label:l.tourFilters.budgetFrom,type:"number",value:i||"",onChange:s=>x(s.target.value?Number(s.target.value):null,u),fullWidth:!0}),e.jsx(h,{label:l.tourFilters.budgetTo,type:"number",value:u||"",onChange:s=>x(i,s.target.value?Number(s.target.value):null),fullWidth:!0}),e.jsxs(f,{fullWidth:!0,children:[e.jsx(b,{children:l.tourFilters.type}),e.jsxs(v,{value:d||"",onChange:s=>j(s.target.value||null),label:l.tourFilters.type,children:[e.jsx(m,{value:"",children:l.tourFilters.typeAll}),Object.values(D).map(s=>e.jsx(m,{value:s,children:l.tourFilters.typeLabels[s]},s))]})]}),e.jsxs(f,{fullWidth:!0,children:[e.jsx(b,{children:l.tourFilters.stars}),e.jsxs(v,{value:p||"",onChange:s=>N(s.target.value?Number(s.target.value):null),label:l.tourFilters.stars,children:[e.jsx(m,{value:"",children:l.tourFilters.starsAll}),e.jsx(m,{value:3,children:"3★"}),e.jsx(m,{value:4,children:"4★"}),e.jsx(m,{value:5,children:"5★"})]})]}),e.jsx(M,{control:e.jsx(P,{checked:c===!0,indeterminate:c===null,onChange:s=>{s.target.checked?n(!0):n(null)}}),label:l.tourFilters.visa}),e.jsx(k,{variant:"secondary",onClick:S,fullWidth:!0,children:l.tourFilters.reset})]})},w=()=>{const[t,r]=y.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mobile-filters__button",children:e.jsxs(F,{onClick:()=>r(!0),className:"mobile-filters__trigger",color:"primary",size:"large",children:[e.jsx(R,{}),e.jsx("span",{children:"Фильтры"})]})}),e.jsxs(L,{anchor:"bottom",open:t,onClose:()=>r(!1),className:"mobile-filters__drawer",PaperProps:{className:"mobile-filters__paper"},children:[e.jsxs("div",{className:"mobile-filters__header",children:[e.jsx("h3",{className:"mobile-filters__title",children:"Фильтры"}),e.jsx(F,{onClick:()=>r(!1),children:e.jsx(E,{})})]}),e.jsx("div",{className:"mobile-filters__content",children:e.jsx(C,{})})]})]})},V=()=>{const{t}=T();return t.toursPage.sortOptions},U=(t,r)=>t.filter(a=>!(r.country&&!a.country.toLowerCase().includes(r.country.toLowerCase())||r.dateFrom&&a.departureDate<r.dateFrom||r.dateTo&&a.returnDate>r.dateTo||r.budgetMin!==null&&a.price<r.budgetMin||r.budgetMax!==null&&a.price>r.budgetMax||r.visaRequired!==null&&a.visaRequired!==r.visaRequired||r.tourType&&a.tourType!==r.tourType||r.stars!==null&&a.stars!==r.stars)),z=(t,r)=>{const a=[...t];switch(r){case"price-asc":a.sort((i,u)=>i.price-u.price);break;case"price-desc":a.sort((i,u)=>u.price-i.price);break;case"duration":a.sort((i,u)=>i.duration-u.duration);break}return a},H=()=>{const{data:t,isLoading:r,isError:a,error:i,refetch:u}=O(),c=_(),[d,p]=y.useState("price-asc"),g=y.useMemo(()=>{if(!t)return[];const o=U(t,c);return z(o,d)},[t,c,d]);return{tours:g,isLoading:r,isError:a,error:i,refetch:u,sortBy:d,setSortBy:p,totalCount:g.length}};function ae(){const{tours:t,isLoading:r,isError:a,error:i,refetch:u,sortBy:c,setSortBy:d,totalCount:p}=H(),g=_(),{t:o}=T(),x=V();return r?e.jsx(B,{fullScreen:!0}):a?e.jsx(A,{error:i,onRetry:()=>u(),title:o.toursPage.errorTitle,message:o.toursPage.errorMessage}):e.jsx("div",{className:"tours-page",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"tours-page__title",children:o.toursPage.title}),e.jsxs("div",{className:"tours-page__content",children:[e.jsx("aside",{className:"tours-page__sidebar",children:e.jsx(C,{})}),e.jsxs("main",{className:"tours-page__main",children:[e.jsx("div",{className:"tours-page__mobile-filters",children:e.jsx(w,{})}),e.jsxs("div",{className:"tours-page__header",children:[e.jsxs("div",{className:"tours-page__count",children:[o.toursPage.found,": ",p]}),e.jsxs(f,{className:"tours-page__sort",children:[e.jsx(b,{children:o.toursPage.sortLabel}),e.jsx(v,{value:c,onChange:n=>d(n.target.value),label:o.toursPage.sortLabel,children:Object.entries(x).map(([n,j])=>e.jsx(m,{value:n,children:j},n))})]})]}),e.jsx("div",{className:"tours-page__grid",children:t.map(n=>e.jsx(I,{tour:n},n.id))}),t.length===0&&e.jsx(q,{title:o.toursPage.emptyTitle,message:o.toursPage.emptyMessage,actionLabel:o.toursPage.emptyAction,onAction:()=>g.resetFilters()})]})]})]})})}export{ae as ToursPage};
